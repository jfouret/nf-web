{% extends 'base.html' %}

{% block content %}
<div id="app" class="container mt-4">
    <h2>Available Pipelines</h2>
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered table-sm">
            <thead class="thead-dark">
                <tr>
                    <th>Pipeline Name</th>
                    <th>Organization</th>
                    <th>Head</th>
                    <th>Tags</th>
                    <th>Branch</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="pipeline in pipelines">
                    <td>{{ '{{ pipeline.project }}' }}</td>
                    <td>{{ '{{ pipeline.organization }}' }}</td>
                    <td>{{ '{{ pipeline.head }}' }}</td>
                    <td>
                        <select class="form-control form-control-sm" v-model="pipeline.tag" @change="checkout(pipeline, pipeline.tag, 'tag')">
                            <option class="font-monospace" v-for="tag in pipeline.tags" :value="tag">{{ '{{ tag }}' }}</eq-option>
                        </select>
                    </td>
                    <td>
                        <select class="form-control form-control-sm" v-model="pipeline.branch" @change="checkout(pipeline, pipeline.branch, 'branch')">
                            <option class="font-monospace" v-for="branch in pipeline.branches" :value="branch">{{ '{{ branch }}' }}</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            pipelines: {{ pipelines | tojson }}
        };
    },
    methods: {
        checkout(pipeline, value, rtype) {
            const postData = {
                organization: pipeline.organization,
                project: pipeline.project,
                value: value,
                rtype: rtype
            };
            fetch('/api/checkout', {  // Assuming you have an API endpoint to handle checkout
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(postData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Checkout successful!');
                } else {
                    alert('Checkout failed: ' + data.message);
                }
            });
        }
    }
}).mount('#app');
</script>

{% endblock %}


